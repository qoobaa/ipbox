<div class="row my-3">
  <div class="col">
    <h2>
      Faktura <%= @invoice.number %>
    </h2>
  </div>
  <div class="col d-print-none text-right">
    <a href="javascript:window.print()" class="btn btn-info">Drukuj ewidencjÄ™</a>
  </div>
</div>

<div class="container">
<table class="table" id="entries">
  <thead>
    <tr>
      <th class="text-center">
        Data
      </th>
      <th class="text-center">
        Opis
      </th>
      <th class="text-center">
        Typ
      </th>
      <th class="text-right">
        Liczba godzin
      </th>
    </tr>
  </thead>
  <tbody>
    <% @invoice.period.each do |day| %>
      <% entries = @invoice.entries.where(day: day).order(ended_at: :asc) %>
      <% total_hours = entries.sum(:hours) %>
      <% if entries.present? %>
        <% entries.each.with_index do |entry, i| %>
          <tr>
            <% if i.zero? %>
              <td rowspan="<%= entries.size %>" class="text-center align-middle">
                <div>
                  <%= l day, format: "%A, %-d %B %Y" %>
                </div>
                <div>
                  <%= entries.sum(:hours) %> godzin
                </div>
              </td>
            <% end %>
            <td>
              <%= render "entries/form", entry: entry %>
              <%= link_to entry.description, "javascript:void(0)", data: {toggle: "modal", target: "#edit_entry_#{entry.id}"}, class: "d-print-none" %>
              <span class="d-none d-print-block"><%= entry.description %></span>
            </td>
            <td class="text-center">
              <% if entry.development? %>
                programowanie
              <% end %>
              <% if entry.maintenance? %>
                utrzymanie
              <% end %>
            </td>
            <td class="text-right">
              <%= entry.hours %>
            </td>
          </tr>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
  <tr>
    <th class="text-right" colspan="3">
      Liczba zafakturowanych godzin
    </th>
    <td class="text-right">
      <%= @invoice.hours %>
    </td>
  </tr>
  <tr>
    <th class="text-right" colspan="3">
      Liczba zaraportowanych godzin
    </th>
    <td class="text-right">
      <%= @invoice.entries.sum(:hours) %>
    </td>
  </tr>
  <tr>
    <th class="text-right" colspan="3">
      Liczba zaraportowanych godzin programowania
    </th>
    <td class="text-right">
      <%= @invoice.entries.development.sum(:hours) %>
    </td>
  </tr>
  <tr>
    <th class="text-right" colspan="3">
      Liczba zaraportowanych godzin utrzymania
    </th>
    <td class="text-right">
      <%= @invoice.entries.maintenance.sum(:hours) %>
    </td>
  </tr>
  <tr>
    <th class="text-right" colspan="3">
      Procent programowania
    </th>
    <td class="text-right">
      <%= number_to_percentage(@invoice.ratio * 100, precision: 0) %>
    </td>
  </tr>
  <tr>
    <th class="text-right" colspan="3">
      Procent utrzymania
    </th>
    <td class="text-right">
      <%= number_to_percentage((1 - @invoice.ratio) * 100, precision: 0) %>
    </td>
  </tr>
</table>
</div>
